parameters:
  - name: api_inputs
    displayName: Inputs from API (json)
    type: string
  - name: config
    displayName: Inputs from user workflow (json)
    type: string


steps:
- bash: |
    export main_branch=$(echo '${{ parameters.config }}' | jq -cr '.default_branch')
    execution_id=$(echo '${{ parameters.api_inputs }}' | jq -cr '.execution_id')

    curl -o script.sh https://workflow-api.qa.stackspot.com/workflows/$execution_id --header 'Authorization: Bearer $(secret_stk_login)'
    chmod +x script.sh

    echo "------------------------------------------------------------------------------------------"
    echo "---------------------------------------- Starting ----------------------------------------"
    echo "------------------------------------------------------------------------------------------"

    bash script.sh

    echo "------------------------------------------------------------------------------------------"
    echo "----------------------------------------  Ending  ----------------------------------------"
    echo "------------------------------------------------------------------------------------------"