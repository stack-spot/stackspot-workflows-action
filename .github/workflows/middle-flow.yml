name: Middle Flow
run-name: ${{ inputs.workflow_name }}
on: 
  workflow_call:
    inputs:
      correlation_id:
        description: Correlation id
        type: string
        required: true
      workflow_name:
        description: Workflow path
        type: string
        required: true
      api_inputs:
        description: Workflow inputs (json)
        type: string
        required: true
      config:
        description: Workflow config
        type: string
        required: true
    secrets:
      secrets:
        description: Secrets info (json)
        required: true

jobs:
  apply:
    if: ${{ inputs.workflow_name == 'apply-plugin' }}
    uses: stack-spot/stackspot-workflows-action/.github/workflows/apply-plugin.yml@release/july-2023
    with:
      api_inputs: ${{ inputs.api_inputs }}
      config: ${{ inputs.config }}
    secrets:
      secrets: ${{ secrets.secrets }}

  create:
    if: ${{ inputs.workflow_name == 'create' }}
    uses: stack-spot/stackspot-workflows-action/.github/workflows/create.yml@release/july-2023
    with:
      api_inputs: ${{ inputs.api_inputs }}
      config: ${{ inputs.config }}
    secrets:
      secrets: ${{ secrets.secrets }}

  run:
    if: ${{ inputs.workflow_name == 'run-action' }}
    uses: stack-spot/stackspot-workflows-action/.github/workflows/run-action.yml@release/july-2023
    with:
      api_inputs: ${{ inputs.api_inputs }}
      config: ${{ inputs.config }}
    secrets:
      secrets: ${{ secrets.secrets }}
